<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Mappa personalizzata (nero + mare blu + montagne verdi)</title>

<link href="https://unpkg.com/maplibre-gl@3.5.2/dist/maplibre-gl.css" rel="stylesheet">
<style>
  html,body {height:100%; margin:0; padding:0; background:#000;}
  #map {position:absolute; inset:0;}
  .coord-box{
    position:absolute; left:10px; bottom:10px;
    font:13px/1.3 monospace;
    background:rgba(0,0,0,.6);
    color:#e7354a;
    padding:6px 10px;
    border-radius:4px;
    z-index:10;
    pointer-events:none;
    user-select:none;
  }
  .center-box{
    position:absolute; top:50%; left:50%;
    width:12px; height:12px;
    background:#e7354a;
    transform:translate(-50%,-50%);
    box-shadow:0 0 8px #e7354a;
    z-index:5;
    pointer-events:none;
  }
  /* Rimuove logo default (se non lo vuoi, mantieni l'attribuzione testuale) */
  .maplibregl-ctrl-logo { display:none !important; }
  .maplibregl-ctrl-attrib {
    background:rgba(0,0,0,.55);
    font-size:11px;
  }
</style>
</head>
<body>
<div id="map"></div>
<div class="center-box"></div>
<div id="coords" class="coord-box">Lat: –, Lng: –</div>

<script src="https://unpkg.com/maplibre-gl@3.5.2/dist/maplibre-gl.js"></script>
<script>
  // Inizializza la mappa
  const map = new maplibregl.Map({
    container: 'map',
    style: 'https://api.maptiler.com/maps/dark/style.json?key=YOUR_MAPTILER_KEY',
    center: [11.25, 43.77], // lng, lat
    zoom: 7,
    pitch: 0,
    attributionControl: true
  });

  // Aggiorna box coordinate al centro
  const coordBox = document.getElementById('coords');
  function updateCenterCoords(){
    const c = map.getCenter();
    coordBox.textContent = `Lat: ${c.lat.toFixed(5)}, Lng: ${c.lng.toFixed(5)}`;
  }

  map.on('load', () => {
    updateCenterCoords();

    // ---- PERSONALIZZAZIONI COLORI ----

    // 1. Sfondo ancora più nero (layer "background" se esiste)
    const bgLayer = map.getStyle().layers.find(l => l.type === 'background');
    if(bgLayer){
      map.setPaintProperty(bgLayer.id, 'background-color', '#000000');
    }

    // 2. Mare blu intenso
    //   I layer d'acqua nei temi MapTiler hanno id tipicamente 'water' e 'waterway-*'
    const waterLayers = map.getStyle().layers.filter(l => 
      (l.type === 'fill' || l.type === 'line') && /water/.test(l.id)
    );
    waterLayers.forEach(l => {
      // fill
      if(l.type === 'fill'){
        map.setPaintProperty(l.id,'fill-color','#0d55c9'); // blu
        map.setPaintProperty(l.id,'fill-opacity',1);
      }
      // line (contorni)
      if(l.type === 'line'){
        try {
          map.setPaintProperty(l.id,'line-color','#1980ff');
        } catch(e){}
      }
    });

    // 3. Aree montuose / vegetazione in verde:
    //    Usiamo il source openmaptiles (presente nella style) e il layer "landcover" + rocce/glaciers.
    //    Filtriamo alcune classi: forest, wood, grass, scrub, park, glacier, rock.
    const labelLayer = map.getStyle().layers.find(l => l.type === 'symbol' && l.layout && l.layout['text-field']);
    map.addLayer({
        id: 'mountain-green',
        type: 'fill',
        source: 'openmaptiles',
        'source-layer': 'landcover',
        filter: ['in','class','forest','wood','grass','scrub','park','glacier','rock'],
        paint: {
          'fill-color': [
            'match',
            ['get','class'],
            'glacier', '#4fe3ff',      // ghiacciai azzurrini
            'rock',    '#18763a',      // roccia leggermente più scura
            /* default per vegetazione */
            '#0d7d35'
          ],
          'fill-opacity': [
            'interpolate',['linear'],['zoom'],
            5, 0.35,
            8, 0.50,
            12, 0.60
          ]
        }
      },
      labelLayer ? labelLayer.id : undefined
    );

    // 4. Sovrappongo un leggero hillshade (se presente) colorato in verde scuro per dare profondità
    //    Alcuni stili includono un layer hillshade (raster). Se esiste lo ritocco.
    const hillshade = map.getStyle().layers.find(l => /hillshade/.test(l.id));
    if(hillshade && hillshade.type === 'raster'){
      // Non sempre è possibile cambiare direttamente i colori di un raster;
      // alternativa: riduco l'opacità per non inquinare il verde.
      map.setPaintProperty(hillshade.id,'raster-opacity',0.25);
    }

    // 5. Strade più scure (facoltativo – se vuoi accentuare il contrasto).
    map.getStyle().layers
      .filter(l => l.type === 'line' && /road|highway|transport/.test(l['source-layer'] || '') )
      .forEach(l => {
        try {
          map.setPaintProperty(l.id,'line-color','#2a2a2a');
        } catch(e){}
      });

  });

  map.on('move', updateCenterCoords);
  map.on('moveend', updateCenterCoords);
  window.addEventListener('resize', () => map.resize());
</script>
</body>
</html>
